<html>
<head>
<title>5.4_Overlay_Heatmap_Curve.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #067d17;}
.s4 { color: #0037a6;}
.s5 { color: #1750eb;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
5.4_Overlay_Heatmap_Curve.py</font>
</center></td></tr></table>
<pre><span class="s0"># ÔºÅ/Programmierung/Anaconda/envs python</span>
<span class="s0"># @File    : 5_Prediction_and_Bewertung</span>
<span class="s0"># -*- coding: utf-8 -*-</span>
<span class="s0"># @Author  : Shun</span>
<span class="s0"># @File    : 5.4_Overlay_Heatmap_Curve</span>
<span class="s0"># @Software: PyCharm</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">pandas </span><span class="s2">as </span><span class="s1">pd</span>
<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">seaborn </span><span class="s2">as </span><span class="s1">sns</span>
<span class="s2">import </span><span class="s1">matplotlib.pyplot </span><span class="s2">as </span><span class="s1">plt</span>
<span class="s2">from </span><span class="s1">scipy.interpolate </span><span class="s2">import </span><span class="s1">interp1d</span>

<span class="s1">normalized_heatmap_folder = </span><span class="s3">&quot;D:</span><span class="s4">\\</span><span class="s3">Programmierung</span><span class="s4">\\</span><span class="s3">Programmierung_fuer_MA</span><span class="s4">\\</span><span class="s3">Final</span><span class="s4">\\</span><span class="s3">5_Prediction_and_Bewertung</span><span class="s4">\\</span><span class="s3">predicted_&quot;</span>
<span class="s1">absolute_distribution_folder = </span><span class="s3">&quot;D:</span><span class="s4">\\</span><span class="s3">Programmierung</span><span class="s4">\\</span><span class="s3">Programmierung_fuer_MA</span><span class="s4">\\</span><span class="s3">Final</span><span class="s4">\\</span><span class="s3">5_Prediction_and_Bewertung</span><span class="s4">\\</span><span class="s3">predicted_&quot;</span>
<span class="s1">output_folder = </span><span class="s3">&quot;D:</span><span class="s4">\\</span><span class="s3">Programmierung</span><span class="s4">\\</span><span class="s3">Programmierung_fuer_MA</span><span class="s4">\\</span><span class="s3">Final</span><span class="s4">\\</span><span class="s3">5_Prediction_and_Bewertung</span><span class="s4">\\</span><span class="s3">Overlay</span><span class="s4">\\</span><span class="s3">Final&quot;</span>

<span class="s1">parameters = [</span>
    <span class="s3">&quot;number_particles&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;power_dissipation&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;power_impact&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;power_shear&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;velocity_absolute_translational&quot;</span><span class="s1">,</span>
    <span class="s3">&quot;velocity_impact_normal_mean&quot;</span>
<span class="s1">]</span>

<span class="s2">for </span><span class="s1">param </span><span class="s2">in </span><span class="s1">parameters:</span>

    <span class="s1">abs_file_path = os.path.join(absolute_distribution_folder, </span><span class="s3">f&quot;</span><span class="s4">{</span><span class="s1">param</span><span class="s4">}</span><span class="s3">_24-11-20 16-30.csv&quot;</span><span class="s1">)</span>
    <span class="s1">abs_data = pd.read_csv(abs_file_path, skiprows=</span><span class="s5">5</span><span class="s1">, header=</span><span class="s2">None</span><span class="s1">).values.flatten()</span>
    <span class="s1">abs_values_sorted = np.sort(abs_data)</span>
    <span class="s1">percentiles = np.linspace(</span><span class="s5">0</span><span class="s1">, </span><span class="s5">1</span><span class="s1">, len(abs_values_sorted))</span>

    <span class="s1">cdf_to_absolute = interp1d(percentiles, abs_values_sorted, fill_value=</span><span class="s3">&quot;extrapolate&quot;</span><span class="s1">)</span>
    <span class="s1">csv_file_path = os.path.join(normalized_heatmap_folder, </span><span class="s3">f&quot;</span><span class="s4">{</span><span class="s1">param</span><span class="s4">}</span><span class="s3">_24-11-21 12-16.csv&quot;</span><span class="s1">)</span>
    <span class="s1">df = pd.read_csv(csv_file_path, header=</span><span class="s5">3</span><span class="s1">)</span>

    <span class="s1">absolute_param_folder = os.path.join(output_folder, param)</span>
    <span class="s1">os.makedirs(absolute_param_folder, exist_ok=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">for </span><span class="s1">column </span><span class="s2">in </span><span class="s1">df.columns:</span>
        <span class="s1">data = df[column].astype(float).values</span>
        <span class="s2">if </span><span class="s1">len(data) != </span><span class="s5">40 </span><span class="s1">* </span><span class="s5">20 </span><span class="s1">* </span><span class="s5">20</span><span class="s1">:</span>
            <span class="s1">print(</span><span class="s3">f&quot;Skipping </span><span class="s4">{</span><span class="s1">param</span><span class="s4">} </span><span class="s3">due to incorrect data dimensions.&quot;</span><span class="s1">)</span>
            <span class="s2">continue</span>

        <span class="s1">reshaped_data = data.reshape((</span><span class="s5">40</span><span class="s1">, </span><span class="s5">20</span><span class="s1">, </span><span class="s5">20</span><span class="s1">))</span>

        <span class="s2">for </span><span class="s1">z_layer, z_data </span><span class="s2">in </span><span class="s1">enumerate(reshaped_data):</span>
            <span class="s1">flat_z_data = z_data.flatten()</span>
            <span class="s1">percentiles_for_data = (flat_z_data - flat_z_data.min()) / (flat_z_data.max() - flat_z_data.min())</span>
            <span class="s1">absolute_heatmap = cdf_to_absolute(percentiles_for_data)</span>

            <span class="s2">if </span><span class="s1">param == </span><span class="s3">&quot;number_particles&quot;</span><span class="s1">:</span>
                <span class="s1">absolute_heatmap = np.round(absolute_heatmap)</span>


            <span class="s1">print(</span><span class="s3">f&quot;Layer </span><span class="s4">{</span><span class="s1">z_layer</span><span class="s4">} </span><span class="s3">- Original normalized data (first 5 values):&quot;</span><span class="s1">, flat_z_data[:</span><span class="s5">5</span><span class="s1">])</span>
            <span class="s1">print(</span><span class="s3">f&quot;Layer </span><span class="s4">{</span><span class="s1">z_layer</span><span class="s4">} </span><span class="s3">- Mapped absolute data (first 5 values):&quot;</span><span class="s1">, absolute_heatmap[:</span><span class="s5">5</span><span class="s1">])</span>

            <span class="s1">absolute_heatmap = absolute_heatmap.reshape(</span><span class="s5">20</span><span class="s1">, </span><span class="s5">20</span><span class="s1">)</span>

            <span class="s1">plt.figure()</span>
            <span class="s1">sns.heatmap(absolute_heatmap, cmap=</span><span class="s3">&quot;jet&quot;</span><span class="s1">, vmin=</span><span class="s5">0</span><span class="s1">)</span>
            <span class="s1">plt.title(</span><span class="s3">f'Z-layer </span><span class="s4">{</span><span class="s1">z_layer</span><span class="s4">}</span><span class="s3">'</span><span class="s1">)</span>
            <span class="s1">plt.axis(</span><span class="s3">'off'</span><span class="s1">)</span>
            <span class="s1">absolute_heatmap_path = os.path.join(absolute_param_folder, </span><span class="s3">f&quot;</span><span class="s4">{</span><span class="s1">param</span><span class="s4">}</span><span class="s3">_Absolute_Z-layer_</span><span class="s4">{</span><span class="s1">z_layer</span><span class="s4">}</span><span class="s3">.png&quot;</span><span class="s1">)</span>
            <span class="s1">plt.savefig(absolute_heatmap_path)</span>
            <span class="s1">plt.close()</span>
</pre>
</body>
</html>